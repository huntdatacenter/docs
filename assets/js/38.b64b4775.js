(window.webpackJsonp=window.webpackJsonp||[]).push([[38,46],{421:function(e,t,i){"use strict";var a=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==a)return a;throw new Error("unable to locate global object")}();e.exports=t=a.fetch,a.fetch&&(t.default=a.fetch.bind(a)),t.Headers=a.Headers,t.Request=a.Request,t.Response=a.Response},432:function(e,t,i){},493:function(e,t,i){"use strict";i(432)},782:function(e,t,i){"use strict";var a=i(368),s=i(400),n=i(377);t.a=Object(a.a)(s.a,Object(n.b)("form")).extend({name:"v-form",provide(){return{form:this}},inheritAttrs:!1,props:{disabled:Boolean,lazyValidation:Boolean,readonly:Boolean,value:Boolean},data:()=>({inputs:[],watchers:[],errorBag:{}}),watch:{errorBag:{handler(e){const t=Object.values(e).includes(!0);this.$emit("input",!t)},deep:!0,immediate:!0}},methods:{watchInput(e){const t=e=>e.$watch("hasError",t=>{this.$set(this.errorBag,e._uid,t)},{immediate:!0}),i={_uid:e._uid,valid:()=>{},shouldValidate:()=>{}};return this.lazyValidation?i.shouldValidate=e.$watch("shouldValidate",a=>{a&&(this.errorBag.hasOwnProperty(e._uid)||(i.valid=t(e)))}):i.valid=t(e),i},validate(){return 0===this.inputs.filter(e=>!e.validate(!0)).length},reset(){this.inputs.forEach(e=>e.reset()),this.resetErrorBag()},resetErrorBag(){this.lazyValidation&&setTimeout(()=>{this.errorBag={}},0)},resetValidation(){this.inputs.forEach(e=>e.resetValidation()),this.resetErrorBag()},register(e){this.inputs.push(e),this.watchers.push(this.watchInput(e))},unregister(e){const t=this.inputs.find(t=>t._uid===e._uid);if(!t)return;const i=this.watchers.find(e=>e._uid===t._uid);i&&(i.valid(),i.shouldValidate()),this.watchers=this.watchers.filter(e=>e._uid!==t._uid),this.inputs=this.inputs.filter(e=>e._uid!==t._uid),this.$delete(this.errorBag,t._uid)}},render(e){return e("form",{staticClass:"v-form",attrs:{novalidate:!0,...this.attrs$},on:{submit:e=>this.$emit("submit",e)}},this.$slots.default)}})},845:function(e,t,i){"use strict";i.r(t);var a=i(547),s=(i(10),i(23),i(27),i(548),i(422),i(443),i(46),i(67),i(128),i(129),i(38),i(36),i(94),i(127),i(201),i(209),i(421)),n=i.n(s),r=i(549),l=i(556),o=i(557),d=i(527),c=i(857),u=i(858),f=i(535),h=i(482),g=i(843),p=i(389),v=i(479),m=i(861),y=i(494),x=i(856),w=i(833),b=i(782),k=i(423),_=i(413),C=i(859),D=i(430),P=i(851),S=i(533),F={name:"PdfForm",components:{EmbedPdfViewer:function(){return Promise.all([i.e(0),i.e(7),i.e(13),i.e(44)]).then(i.bind(null,844))},VApp:d.a,VCol:c.a,VRow:u.a,VList:f.a,VListItem:h.a,VListItemTitle:g.b,VListItemContent:g.a,VSheet:p.a,VCard:v.a,VCardTitle:m.d,VCardSubtitle:m.b,VCardText:m.c,VToolbar:y.a,VToolbarTitle:x.b,VToolbarItems:x.a,VSpacer:w.a,VForm:b.a,VBtn:k.a,VTextField:_.a,VAutocomplete:C.a,VTextarea:D.a,VDialog:P.a,VDivider:S.a},props:{id:{type:String,default:"applet"},url:{type:String,default:null},title:{type:String,default:"Agreement"},fields:{type:Array,default:null}},data:function(){return{formData:{},layout:{formCols:5,pdfCols:7,hidePdf:!1},canvasOffsets:{},signatures:{},pdfSignatures:{},pdfDoc:null,pdfFields:[],pdfFile:null,pdfPages:1,showPdf:!1,downloadPdf:!1,pdfTimestamp:(new Date).toISOString(),dialogs:{},signaturePad:null,defaultScale:.04,drawer:null,expandForm:!0}},computed:{getCountries:function(){return l.a?l.a:[]},formFilled:function(){var e=this;return this.fields.filter((function(e){return e.key})).every((function(t){return!(!e.formData[t.key]&&e.isFieldRequired(t.required))}))},pdfData:function(){return this.pdfFile?this.pdfFile:""},getPdfTitle:function(){var e=new Date,t=e.getFullYear()+("0"+(e.getMonth()+1)).slice(-2)+("0"+e.getDate()).slice(-2)+"-"+("0"+e.getHours()).slice(-2)+("0"+e.getMinutes()).slice(-2)+("0"+e.getSeconds()).slice(-2);return"agreement-".concat(t,".pdf")}},watch:{expandForm:function(e){if(e){this.layout={formCols:12,pdfCols:12,hidePdf:!0}}else{this.layout={formCols:5,pdfCols:7,hidePdf:!1}}}},mounted:function(){},created:function(){var e=this;this.fields.filter((function(e){return"signature"===e.field})).forEach((function(t){e.dialogs=Object.assign({},e.dialogs,Object(a.a)({},t.key,null)),e.pdfSignatures[t.key]={page:t.page&&t.page>0?t.page:0,xpos:t.xpos&&t.xpos>0?t.xpos:.5,ypos:t.ypos&&t.ypos>0?t.ypos:.5,scale:t.scale&&t.scale>0?t.scale:e.defaultScale}})),this.url&&this.loadPdf(this.url)},methods:{loadPdf:function(e){var t=this;try{n()(e).then((function(e){if(!e.ok)throw new Error("unexpected response ".concat(e.statusText));return e.arrayBuffer()})).then((function(e){t.pdfBuffer=e;try{var i=t.pdfBuffer;r.PDFDocument.load(i).then((function(e){t.pdfDoc=e,t.pdfDoc.saveAsBase64({dataUri:!0}).then((function(i){var a=e.getPages().length;t.browsePdf(i,a,!0)}));var i=e.getForm();t.pdfFields=i.getFields().map((function(e){return e.getName()})),console.log(t.pdfFields)}))}catch(e){console.log("Failed to read fields"),console.log(e)}}))}catch(e){console.log(e)}},getTimestamp:function(){return(new Date).toISOString()},isFieldRequired:function(e){return!(!e||"false"===e)},addSignature:function(e){var t=this,i=document.getElementById("signature-pad--".concat(e));if(i){var a=i.querySelector("canvas");this.signatures[e]={},this.signatures[e].signed=!1,this.signatures[e].canvas=a;var s=new o.a(a,{dotSize:2,minWidth:1.5,maxWidth:4});this.signatures[e].signature=s,s.addEventListener("beginStroke",(function(){console.log("Signature started")}),{once:!0}),window.addEventListener("resize",this.resizeCanvas),this.$nextTick((function(){t.resizeCanvas(null,e)}))}else console.log("No wrapper found for id: signature-pad--".concat(e))},resizeCanvas:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=i?[i]:Object.keys(this.signatures);a.forEach((function(e){var i=document.getElementById("signature-pad--".concat(e));if(i){var a=i.querySelector("canvas"),s=Math.max(window.devicePixelRatio||1,1);if(t.canvasOffsets&&t.canvasOffsets[e]&&t.canvasOffsets[e].width&&t.canvasOffsets[e].height)var n=t.canvasOffsets[e].width,r=t.canvasOffsets[e].height;else{n=a.offsetWidth,r=a.offsetHeight;t.canvasOffsets[e]={width:n,height:r}}console.log("Canvas current size ".concat(n," x ").concat(r," (device ratio: ").concat(window.devicePixelRatio,")")),a.width=n*s,a.height=r*s,a.getContext("2d").scale(s,s),t.signatures[e].signature.clear()}else console.log("No wrapper found for id: signature-pad--".concat(e))}))},openDialog:function(e){var t=this;this.dialogs=Object.assign({},this.dialogs,Object(a.a)({},e,!0)),this.$nextTick((function(){t.addSignature(e)}))},closeDialog:function(e){this.dialogs=Object.assign({},this.dialogs,Object(a.a)({},e,!1))},saveDialog:function(e){this.dialogs=Object.assign({},this.dialogs,Object(a.a)({},e,!1)),this.signatures[e].signed=!this.signatures[e].signature.isEmpty(),console.log("Signature signed [".concat(e,"]: ").concat(this.signatures[e].signed)),this.signatures[e].pngurl=this.signatures[e].signature.toDataURL()},submit:function(){var e=this;console.log(this.formData);try{var t=this.pdfBuffer;r.PDFDocument.load(t).then((function(t){var i=t.getForm();e.fields.forEach((function(t){t.key&&!["section","signature"].includes(t.field)&&e.formData[t.key]&&i.getTextField(t.key).setText(e.formData[t.key])})),i.flatten();var a=Object.keys(e.signatures).filter((function(t){return e.signatures[t].signed}));if(a.length>0){var s=a.map((function(i){var a=e.signatures[i].pngurl;return t.embedPng(a).then((function(a){var s=a,n=t.getPages(),r=e.pdfSignatures[i].page,l=n[r],o=s.scale(e.pdfSignatures[i].scale),d=l.getWidth()*e.pdfSignatures[i].xpos,c=l.getHeight()*e.pdfSignatures[i].ypos;console.log("Page ".concat(r," (").concat(l.getWidth()," x ").concat(l.getHeight(),") - insert image ").concat(i,".png (").concat(o.width," x ").concat(o.height,") at position ").concat(d," x ").concat(c)),l.drawImage(s,{x:d,y:c,width:o.width,height:o.height})}))}));Promise.all(s).then((function(){console.log("Render PDF with signatures"),t.saveAsBase64({dataUri:!0}).then((function(i){var a=t.getPages().length;e.browsePdf(i,a,!0,!0)}))}))}else console.log("PDF without signatures"),t.saveAsBase64({dataUri:!0}).then((function(i){var a=t.getPages().length;e.browsePdf(i,a,!0,!0)}))}))}catch(e){console.log(e)}},browsePdf:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=t;this.pdfFile=n,this.pdfPages=i,this.pdfTimestamp=this.getTimestamp(),this.showPdf=a,this.$nextTick((function(){e.downloadPdf=s}))}}},V=(i(493),i(41)),O=Object(V.a)(F,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-sheet",{staticClass:"d-flex flex-xs-wrap flex-sm-wrap flex-md-nowrap flex-lg-nowrap flex-xl-nowrap h-100 w-100 align-self-center",staticStyle:{"max-width":"1680px"}},[i("v-sheet",{staticClass:"flex-grow-1 flex-shrink-0 mx-2 px-2 h-100 h-xs-auto h-sm-auto overflow-y-auto col-12 col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6",staticStyle:{"min-width":"300px","max-width":"100%"}},[i("form",{ref:"form",on:{submit:function(t){return t.preventDefault(),e.submit.apply(null,arguments)}}},[i("v-list",[i("v-list-item",[i("p",{staticClass:"font-weight-bold py-0 my-0"},[e._v(e._s(e.title))])]),e._v(" "),e._l(e.fields,(function(t){return["divider"===t.field?i("v-divider",{key:t.key}):e._e(),e._v(" "),"section"===t.field?i("v-list-item",{key:t.key,attrs:{cols:"12",dense:""}},[i("p",{staticClass:"text-darken-1 py-0 mt-0 mb-2"},[e._v(e._s(t.label))])]):e._e(),e._v(" "),"textfield"===t.field?i("v-list-item",{key:t.key,attrs:{cols:"12",dense:""}},[i("v-text-field",{ref:t.key,refInFor:!0,staticClass:"mb-3",attrs:{autocomplete:"ignore-field",pattern:t.pattern?t.pattern:null,title:t.hint?t.hint:null,minlength:t.minlength?t.minlength:null,maxlength:t.maxlength?t.maxlength:null,required:e.isFieldRequired(t.required),autocapitalize:t.autocapitalize?t.autocapitalize:null,suffix:t.suffix?t.suffix:null,type:t.specialType?t.specialType:null,hint:t.hint?t.hint:null,"persistent-hint":!(!t.hint||!e.formData[t.key]),placeholder:"","persistent-placeholder":"",outlined:"",dense:"","hide-details":!e.formData[t.key]&&"auto"},on:{focus:function(e){return e.target.select()}},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                "+e._s(t.label)),e.isFieldRequired(t.required)?i("span",{staticClass:"red--text text--darken-2"},[e._v(" * ")]):e._e()]},proxy:!0}],null,!0),model:{value:e.formData[t.key],callback:function(i){e.$set(e.formData,t.key,i)},expression:"formData[item.key]"}})],1):e._e(),e._v(" "),"countries"===t.field?i("v-list-item",{key:t.key,attrs:{cols:"12",dense:""}},[i("v-autocomplete",{ref:t.key,refInFor:!0,staticClass:"mb-3",attrs:{autocomplete:"ignore-field",items:e.getCountries,"item-text":function(e){return e.name+" "+e.flag},"item-value":function(e){return e.name},required:e.isFieldRequired(t.required),placeholder:"","persistent-placeholder":"",outlined:"",dense:"","hide-details":""},on:{focus:function(e){return e.target.select()}},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                "+e._s(t.label)),e.isFieldRequired(t.required)?i("span",{staticClass:"red--text text--darken-2"},[e._v(" * ")]):e._e()]},proxy:!0}],null,!0),model:{value:e.formData[t.key],callback:function(i){e.$set(e.formData,t.key,i)},expression:"formData[item.key]"}})],1):e._e(),e._v(" "),"textarea"===t.field?i("v-list-item",{key:t.key,attrs:{cols:"12",dense:""}},[i("v-textarea",{ref:t.key,refInFor:!0,staticClass:"mb-3",attrs:{autocomplete:"ignore-field",pattern:t.pattern?t.pattern:null,title:t.hint?t.hint:null,minlength:t.minlength?t.minlength:null,maxlength:t.maxlength?t.maxlength:null,required:e.isFieldRequired(t.required),hint:t.hint?t.hint:null,"persistent-hint":!(!t.hint||!e.formData[t.key]),placeholder:"","persistent-placeholder":"",outlined:"",dense:"",rows:1,"hide-details":!e.formData[t.key]&&"auto"},on:{focus:function(e){return e.target.select()}},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                "+e._s(t.label)),e.isFieldRequired(t.required)?i("span",{staticClass:"red--text text--darken-2"},[e._v(" * ")]):e._e()]},proxy:!0}],null,!0),model:{value:e.formData[t.key],callback:function(i){e.$set(e.formData,t.key,i)},expression:"formData[item.key]"}})],1):e._e(),e._v(" "),"signature"===t.field?i("v-list-item",{key:t.key,attrs:{cols:"12",dense:""}},[i("v-card",{staticClass:"px-0 mb-3",staticStyle:{width:"100%"},attrs:{elevation:"0",outlined:""}},[i("v-card-text",[i("v-row",{staticClass:"mr-xs-12 pr-sm-8",attrs:{justify:"space-between","no-gutters":""}},[i("v-col",{attrs:{cols:"8"}},[i("div",{staticClass:"font-weight-bold"},[e._v(e._s(t.label))])]),e._v(" "),i("v-col",{attrs:{cols:"4"}},[i("v-btn",{attrs:{color:"primary",block:""},on:{click:function(i){return e.openDialog(t.key)}}},[e._v("\n                      Add signature\n                    ")])],1)],1),e._v(" "),i("v-row",{staticClass:"mr-xs-12 pr-sm-8",attrs:{align:"center",justify:"space-between","no-gutters":""}},[i("v-col",{staticStyle:{height:"40px"},attrs:{cols:"12"}},[e.signatures&&e.signatures[t.key]&&e.signatures[t.key].signed?i("div",[i("img",{staticStyle:{"max-height":"40px"},attrs:{src:e.signatures[t.key].pngurl}})]):i("div",[e._v("\n                      Add digital signature now or sign later\n                    ")])])],1),e._v(" "),i("v-dialog",{attrs:{fullscreen:"","hide-overlay":"",transition:"dialog-bottom-transition"},model:{value:e.dialogs[t.key],callback:function(i){e.$set(e.dialogs,t.key,i)},expression:"dialogs[item.key]"}},[i("v-card",{staticClass:"prevent-select",staticStyle:{height:"100%"}},[i("v-toolbar",[i("v-toolbar-title",[e._v(e._s(t.label))]),e._v(" "),i("v-spacer"),e._v(" "),i("v-btn",{attrs:{text:""},on:{click:function(i){return e.closeDialog(t.key)}}},[e._v("\n                        Close\n                      ")]),e._v(" "),i("v-toolbar-items",[i("v-btn",{attrs:{text:""},on:{click:function(i){return e.saveDialog(t.key)}}},[e._v("\n                          Save\n                        ")])],1)],1),e._v(" "),i("div",{staticClass:"signature-card"},[i("div",{staticClass:"signature-pad mt-8",attrs:{id:"signature-pad--"+t.key}},[i("div",{staticClass:"signature-pad--body"},[i("canvas")]),e._v(" "),i("div",{staticClass:"signature-pad--footer"},[i("div",{staticClass:"description"},[e._v("Sign above")])])])])],1)],1)],1)],1)],1):e._e()]})),e._v(" "),i("v-list-item",[i("v-row",{staticClass:"px-2",attrs:{align:"center",justify:"space-around"}},[i("v-col",{attrs:{cols:"12"}},[i("v-btn",{staticClass:"mr-8 px-0",attrs:{type:"submit",block:"",color:"teal",disabled:!e.formFilled}},[e._v("Generate Agreement")])],1)],1)],1),e._v(" "),i("v-list-item",[i("v-row",{staticClass:"px-2",attrs:{align:"center",justify:"space-around"}},[i("v-col",{attrs:{cols:"12"}},[i("v-btn",{staticClass:"mr-8 px-0",attrs:{block:"",color:"success",href:e.pdfFile,download:e.getPdfTitle,target:"_blank",disabled:!e.pdfFile||!e.downloadPdf}},[e._v("Download Agreement")])],1)],1)],1)],2)],1)]),e._v(" "),i("v-sheet",{staticClass:"flex-grow-1 flex-shrink-1 mx-2 px-2 h-100 col-12 col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6",staticStyle:{"min-width":"300px","max-width":"100%"}},[!e.showPdf?e._e():i("EmbedPdfViewer",{attrs:{source:e.pdfData,pages:e.pdfPages,height:"500"}})],1)],1)}),[],!1,null,null,null);t.default=O.exports}}]);