(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{478:function(t,e,a){},562:function(t,e,a){"use strict";a(478)},854:function(t,e,a){"use strict";a.r(e);var s=a(531),i=(a(10),a(23),a(27),a(532),a(439),a(471),a(46),a(68),a(128),a(129),a(38),a(36),a(94),a(127),a(201),a(209),a(447)),n=a.n(i),l=a(535),o=a(559),r=a(560),c=a(485),d=a(864),u=a(865),f=a(431),g=a(414),p=a(481),h=a(385),v=a(448),m=a(834),y=a(426),x=a(595),k=a(608),b=a(828),w=a(444),_=a(594),C=a(844),D=a(407),S=a(597),P=a(450),F=a(563),V=a(437),T={name:"PdfForm",components:{EmbedPdfViewer:function(){return Promise.all([a.e(0),a.e(8),a.e(12),a.e(45)]).then(a.bind(null,853))},VApp:c.a,VCol:d.a,VRow:u.a,VList:f.a,VListItem:g.a,VListItemTitle:p.b,VListItemContent:p.a,VSheet:h.a,VCard:v.a,VCardTitle:m.d,VCardSubtitle:m.b,VCardText:m.c,VToolbar:y.a,VToolbarTitle:x.b,VToolbarItems:x.a,VSpacer:k.a,VForm:b.a,VBtn:w.a,VIcon:_.a,VTooltip:C.a,VTextField:D.a,VAutocomplete:S.a,VTextarea:P.a,VDialog:F.a,VDivider:V.a},props:{id:{type:String,default:"applet"},url:{type:String,default:null},title:{type:String,default:"Agreement"},fields:{type:Array,default:null}},data:function(){return{formData:{},layout:{formCols:5,pdfCols:7,hidePdf:!1},canvasOffsets:{},signatures:{},pdfSignatures:{},pdfDoc:null,pdfFields:[],pdfFile:null,pdfPages:1,showPdf:!1,downloadPdf:!1,pdfTimestamp:(new Date).toISOString(),dialogs:{},signaturePad:null,defaultScale:.04,drawer:null,expandForm:!0}},computed:{getCountries:function(){return o.a?o.a:[]},formFilled:function(){var t=this;return this.fields.filter((function(t){return t.key})).every((function(e){return!(!t.formData[e.key]&&t.isFieldRequired(e.required))}))},pdfData:function(){return this.pdfFile?this.pdfFile:""},getPdfTitle:function(){var t=new Date,e=t.getFullYear()+("0"+(t.getMonth()+1)).slice(-2)+("0"+t.getDate()).slice(-2)+"-"+("0"+t.getHours()).slice(-2)+("0"+t.getMinutes()).slice(-2)+("0"+t.getSeconds()).slice(-2);return"agreement-".concat(e,".pdf")}},watch:{expandForm:function(t){if(t){this.layout={formCols:12,pdfCols:12,hidePdf:!0}}else{this.layout={formCols:5,pdfCols:7,hidePdf:!1}}}},mounted:function(){},created:function(){var t=this;this.fields.filter((function(t){return"signature"===t.field})).forEach((function(e){t.dialogs=Object.assign({},t.dialogs,Object(s.a)({},e.key,null)),t.pdfSignatures[e.key]={page:e.page&&e.page>0?e.page:0,xpos:e.xpos&&e.xpos>0?e.xpos:.5,ypos:e.ypos&&e.ypos>0?e.ypos:.5,scale:e.scale&&e.scale>0?e.scale:t.defaultScale}})),this.url&&this.loadPdf(this.url)},methods:{loadPdf:function(t){var e=this;try{n()(t).then((function(t){if(!t.ok)throw new Error("unexpected response ".concat(t.statusText));return t.arrayBuffer()})).then((function(t){e.pdfBuffer=t;try{var a=e.pdfBuffer;l.PDFDocument.load(a).then((function(t){e.pdfDoc=t,e.pdfDoc.saveAsBase64({dataUri:!0}).then((function(a){var s=t.getPages().length;e.browsePdf(a,s,!0)}));var a=t.getForm();e.pdfFields=a.getFields().map((function(t){return t.getName()})),console.log(e.pdfFields)}))}catch(t){console.log("Failed to read fields"),console.log(t)}}))}catch(t){console.log(t)}},getTimestamp:function(){return(new Date).toISOString()},isFieldRequired:function(t){return!(!t||"false"===t)},addSignature:function(t){var e=this,a=document.getElementById("signature-pad--".concat(t));if(a){var s=a.querySelector("canvas");this.signatures[t]={},this.signatures[t].signed=!1,this.signatures[t].canvas=s;var i=new r.a(s,{dotSize:2,minWidth:1.5,maxWidth:4});this.signatures[t].signature=i,i.addEventListener("beginStroke",(function(){console.log("Signature started")}),{once:!0}),window.addEventListener("resize",this.resizeCanvas),this.$nextTick((function(){e.resizeCanvas(null,t)}))}else console.log("No wrapper found for id: signature-pad--".concat(t))},resizeCanvas:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=a?[a]:Object.keys(this.signatures);s.forEach((function(t){var a=document.getElementById("signature-pad--".concat(t));if(a){var s=a.querySelector("canvas"),i=Math.max(window.devicePixelRatio||1,1);if(e.canvasOffsets&&e.canvasOffsets[t]&&e.canvasOffsets[t].width&&e.canvasOffsets[t].height)var n=e.canvasOffsets[t].width,l=e.canvasOffsets[t].height;else{n=s.offsetWidth,l=s.offsetHeight;e.canvasOffsets[t]={width:n,height:l}}console.log("Canvas current size ".concat(n," x ").concat(l," (device ratio: ").concat(window.devicePixelRatio,")")),s.width=n*i,s.height=l*i,s.getContext("2d").scale(i,i),e.signatures[t].signature.clear()}else console.log("No wrapper found for id: signature-pad--".concat(t))}))},openDialog:function(t){var e=this;this.dialogs=Object.assign({},this.dialogs,Object(s.a)({},t,!0)),this.$nextTick((function(){e.addSignature(t)}))},closeDialog:function(t){this.dialogs=Object.assign({},this.dialogs,Object(s.a)({},t,!1))},saveDialog:function(t){this.dialogs=Object.assign({},this.dialogs,Object(s.a)({},t,!1)),this.signatures[t].signed=!this.signatures[t].signature.isEmpty(),console.log("Signature signed [".concat(t,"]: ").concat(this.signatures[t].signed)),this.signatures[t].pngurl=this.signatures[t].signature.toDataURL()},submit:function(){var t=this;console.log(this.formData);try{var e=this.pdfBuffer;l.PDFDocument.load(e).then((function(e){var a=e.getForm();t.fields.forEach((function(e){e.key&&!["section","signature"].includes(e.field)&&t.formData[e.key]&&a.getTextField(e.key).setText(t.formData[e.key])})),a.flatten();var s=Object.keys(t.signatures).filter((function(e){return t.signatures[e].signed}));if(s.length>0){var i=s.map((function(a){var s=t.signatures[a].pngurl;return e.embedPng(s).then((function(s){var i=s,n=e.getPages(),l=t.pdfSignatures[a].page,o=n[l],r=i.scale(t.pdfSignatures[a].scale),c=o.getWidth()*t.pdfSignatures[a].xpos,d=o.getHeight()*t.pdfSignatures[a].ypos;console.log("Page ".concat(l," (").concat(o.getWidth()," x ").concat(o.getHeight(),") - insert image ").concat(a,".png (").concat(r.width," x ").concat(r.height,") at position ").concat(c," x ").concat(d)),o.drawImage(i,{x:c,y:d,width:r.width,height:r.height})}))}));Promise.all(i).then((function(){console.log("Render PDF with signatures"),e.saveAsBase64({dataUri:!0}).then((function(a){var s=e.getPages().length;t.browsePdf(a,s,!0,!0)}))}))}else console.log("PDF without signatures"),e.saveAsBase64({dataUri:!0}).then((function(a){var s=e.getPages().length;t.browsePdf(a,s,!0,!0)}))}))}catch(t){console.log(t)}},browsePdf:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=e;this.pdfFile=n,this.pdfPages=a,this.pdfTimestamp=this.getTimestamp(),this.showPdf=s,this.$nextTick((function(){t.downloadPdf=i}))},showTooltip:function(t){console.log(t)}}},O=(a(562),a(41)),q=Object(O.a)(T,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-sheet",{staticClass:"d-flex flex-xs-wrap flex-sm-wrap flex-md-nowrap flex-lg-nowrap flex-xl-nowrap h-100 w-100 align-self-center",staticStyle:{"max-width":"1680px"}},[a("v-sheet",{staticClass:"flex-grow-1 flex-shrink-0 mx-2 px-2 h-100 h-xs-auto h-sm-auto overflow-y-auto col-12 col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6",staticStyle:{"min-width":"300px","max-width":"100%"}},[a("form",{ref:"form",on:{submit:function(e){return e.preventDefault(),t.submit.apply(null,arguments)}}},[a("v-list",[a("v-list-item",[a("p",{staticClass:"font-weight-bold py-0 my-0"},[t._v(t._s(t.title))])]),t._v(" "),t._l(t.fields,(function(e){return["divider"===e.field?a("v-divider",{key:e.key}):t._e(),t._v(" "),"section"===e.field?a("v-list-item",{key:e.key,attrs:{cols:"12",dense:""}},[a("p",{staticClass:"text-darken-1 py-0 mt-0 mb-2"},[t._v(t._s(e.label))])]):t._e(),t._v(" "),"textfield"===e.field?a("v-list-item",{key:e.key,attrs:{cols:"12",dense:""}},[a("v-text-field",{ref:e.key,refInFor:!0,staticClass:"mb-3",attrs:{autocomplete:"ignore-field",pattern:e.pattern?e.pattern:null,title:e.hint?e.hint:null,minlength:e.minlength?e.minlength:null,maxlength:e.maxlength?e.maxlength:null,required:t.isFieldRequired(e.required),autocapitalize:e.autocapitalize?e.autocapitalize:null,suffix:e.suffix?e.suffix:null,type:e.specialType?e.specialType:null,hint:e.hint?e.hint:null,"persistent-hint":!(!e.hint||!t.formData[e.key]),placeholder:"","persistent-placeholder":"",outlined:"",dense:"","hide-details":!t.formData[e.key]&&"auto"},on:{focus:function(t){return t.target.select()}},scopedSlots:t._u([{key:"label",fn:function(){return[t._v("\n                "+t._s(e.label)),t.isFieldRequired(e.required)?a("span",{staticClass:"red--text text--darken-2"},[t._v(" * ")]):t._e()]},proxy:!0},!e.tooltip?null:{key:"append",fn:function(){return[a("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(e){var s=e.on,i=e.attrs;return[a("v-btn",t._g(t._b({attrs:{icon:"","x-small":""}},"v-btn",i,!1),s),[a("v-icon",{staticClass:"material-icons"},[t._v("info")])],1)]}}],null,!0)},[t._v(" "),a("span",[t._v(t._s(e.tooltip))])])]},proxy:!0}],null,!0),model:{value:t.formData[e.key],callback:function(a){t.$set(t.formData,e.key,a)},expression:"formData[item.key]"}})],1):t._e(),t._v(" "),"countries"===e.field?a("v-list-item",{key:e.key,attrs:{cols:"12",dense:""}},[a("v-autocomplete",{ref:e.key,refInFor:!0,staticClass:"mb-3",attrs:{autocomplete:"ignore-field",items:t.getCountries,"item-text":function(t){return t.name+" "+t.flag},"item-value":function(t){return t.name},required:t.isFieldRequired(e.required),placeholder:"","persistent-placeholder":"",outlined:"",dense:"","hide-details":""},on:{focus:function(t){return t.target.select()}},scopedSlots:t._u([{key:"label",fn:function(){return[t._v("\n                "+t._s(e.label)),t.isFieldRequired(e.required)?a("span",{staticClass:"red--text text--darken-2"},[t._v(" * ")]):t._e()]},proxy:!0}],null,!0),model:{value:t.formData[e.key],callback:function(a){t.$set(t.formData,e.key,a)},expression:"formData[item.key]"}})],1):t._e(),t._v(" "),"textarea"===e.field?a("v-list-item",{key:e.key,attrs:{cols:"12",dense:""}},[a("v-textarea",{ref:e.key,refInFor:!0,staticClass:"mb-3",attrs:{autocomplete:"ignore-field",pattern:e.pattern?e.pattern:null,title:e.hint?e.hint:null,minlength:e.minlength?e.minlength:null,maxlength:e.maxlength?e.maxlength:null,required:t.isFieldRequired(e.required),hint:e.hint?e.hint:null,"persistent-hint":!(!e.hint||!t.formData[e.key]),placeholder:"","persistent-placeholder":"",outlined:"",dense:"",rows:1,"hide-details":!t.formData[e.key]&&"auto"},on:{focus:function(t){return t.target.select()}},scopedSlots:t._u([{key:"label",fn:function(){return[t._v("\n                "+t._s(e.label)),t.isFieldRequired(e.required)?a("span",{staticClass:"red--text text--darken-2"},[t._v(" * ")]):t._e()]},proxy:!0}],null,!0),model:{value:t.formData[e.key],callback:function(a){t.$set(t.formData,e.key,a)},expression:"formData[item.key]"}})],1):t._e(),t._v(" "),"signature"===e.field?a("v-list-item",{key:e.key,attrs:{cols:"12",dense:""}},[a("v-card",{staticClass:"px-0 mb-3",staticStyle:{width:"100%"},attrs:{elevation:"0",outlined:""}},[a("v-card-text",[a("v-row",{staticClass:"mr-xs-12 pr-sm-8",attrs:{justify:"space-between","no-gutters":""}},[a("v-col",{attrs:{cols:"8"}},[a("div",{staticClass:"font-weight-bold"},[t._v(t._s(e.label))])]),t._v(" "),a("v-col",{attrs:{cols:"4"}},[a("v-btn",{attrs:{color:"primary",block:""},on:{click:function(a){return t.openDialog(e.key)}}},[t._v("\n                      Add signature\n                    ")])],1)],1),t._v(" "),a("v-row",{staticClass:"mr-xs-12 pr-sm-8",attrs:{align:"center",justify:"space-between","no-gutters":""}},[a("v-col",{staticStyle:{height:"40px"},attrs:{cols:"12"}},[t.signatures&&t.signatures[e.key]&&t.signatures[e.key].signed?a("div",[a("img",{staticStyle:{"max-height":"40px"},attrs:{src:t.signatures[e.key].pngurl}})]):a("div",[t._v("\n                      Add digital signature now or sign later\n                    ")])])],1),t._v(" "),a("v-dialog",{attrs:{fullscreen:"","hide-overlay":"",transition:"dialog-bottom-transition"},model:{value:t.dialogs[e.key],callback:function(a){t.$set(t.dialogs,e.key,a)},expression:"dialogs[item.key]"}},[a("v-card",{staticClass:"prevent-select",staticStyle:{height:"100%"}},[a("v-toolbar",[a("v-toolbar-title",[t._v(t._s(e.label))]),t._v(" "),a("v-spacer"),t._v(" "),a("v-btn",{attrs:{text:""},on:{click:function(a){return t.closeDialog(e.key)}}},[t._v("\n                        Close\n                      ")]),t._v(" "),a("v-toolbar-items",[a("v-btn",{attrs:{text:""},on:{click:function(a){return t.saveDialog(e.key)}}},[t._v("\n                          Save\n                        ")])],1)],1),t._v(" "),a("div",{staticClass:"signature-card"},[a("div",{staticClass:"signature-pad mt-8",attrs:{id:"signature-pad--"+e.key}},[a("div",{staticClass:"signature-pad--body"},[a("canvas")]),t._v(" "),a("div",{staticClass:"signature-pad--footer"},[a("div",{staticClass:"description"},[t._v("Sign above")])])])])],1)],1)],1)],1)],1):t._e()]})),t._v(" "),a("v-list-item",[a("v-row",{staticClass:"px-2",attrs:{align:"center",justify:"space-around"}},[a("v-col",{attrs:{cols:"12"}},[a("v-btn",{staticClass:"mr-8 px-0",attrs:{type:"submit",block:"",color:"teal",disabled:!t.formFilled}},[t._v("Generate Agreement")])],1)],1)],1),t._v(" "),a("v-list-item",[a("v-row",{staticClass:"px-2",attrs:{align:"center",justify:"space-around"}},[a("v-col",{attrs:{cols:"12"}},[a("v-btn",{staticClass:"mr-8 px-0",attrs:{block:"",color:"success",href:t.pdfFile,download:t.getPdfTitle,target:"_blank",disabled:!t.pdfFile||!t.downloadPdf}},[t._v("Download Agreement")])],1)],1)],1)],2)],1)]),t._v(" "),a("v-sheet",{staticClass:"flex-grow-1 flex-shrink-1 mx-2 px-2 h-100 col-12 col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6",staticStyle:{"min-width":"300px","max-width":"100%"}},[!t.showPdf?t._e():a("EmbedPdfViewer",{attrs:{source:t.pdfData,pages:t.pdfPages,height:"500"}})],1)],1)}),[],!1,null,null,null);e.default=q.exports}}]);