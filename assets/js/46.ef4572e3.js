(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{432:function(e,t,a){},493:function(e,t,a){"use strict";a(432)},845:function(e,t,a){"use strict";a.r(t);var s=a(547),i=(a(10),a(23),a(27),a(548),a(422),a(443),a(46),a(67),a(128),a(129),a(38),a(36),a(94),a(127),a(201),a(209),a(421)),n=a.n(i),l=a(549),o=a(556),r=a(557),c=a(527),d=a(857),u=a(858),f=a(535),g=a(482),h=a(843),p=a(389),v=a(479),m=a(861),y=a(494),x=a(856),k=a(833),b=a(782),w=a(423),_=a(413),C=a(859),D=a(430),S=a(851),P=a(533),F={name:"PdfForm",components:{EmbedPdfViewer:function(){return Promise.all([a.e(0),a.e(7),a.e(13),a.e(44)]).then(a.bind(null,844))},VApp:c.a,VCol:d.a,VRow:u.a,VList:f.a,VListItem:g.a,VListItemTitle:h.b,VListItemContent:h.a,VSheet:p.a,VCard:v.a,VCardTitle:m.d,VCardSubtitle:m.b,VCardText:m.c,VToolbar:y.a,VToolbarTitle:x.b,VToolbarItems:x.a,VSpacer:k.a,VForm:b.a,VBtn:w.a,VTextField:_.a,VAutocomplete:C.a,VTextarea:D.a,VDialog:S.a,VDivider:P.a},props:{id:{type:String,default:"applet"},url:{type:String,default:null},title:{type:String,default:"Agreement"},fields:{type:Array,default:null}},data:function(){return{formData:{},layout:{formCols:5,pdfCols:7,hidePdf:!1},canvasOffsets:{},signatures:{},pdfSignatures:{},pdfDoc:null,pdfFields:[],pdfFile:null,pdfPages:1,showPdf:!1,downloadPdf:!1,pdfTimestamp:(new Date).toISOString(),dialogs:{},signaturePad:null,defaultScale:.04,drawer:null,expandForm:!0}},computed:{getCountries:function(){return o.a?o.a:[]},formFilled:function(){var e=this;return this.fields.filter((function(e){return e.key})).every((function(t){return!(!e.formData[t.key]&&e.isFieldRequired(t.required))}))},pdfData:function(){return this.pdfFile?this.pdfFile:""},getPdfTitle:function(){var e=new Date,t=e.getFullYear()+("0"+(e.getMonth()+1)).slice(-2)+("0"+e.getDate()).slice(-2)+"-"+("0"+e.getHours()).slice(-2)+("0"+e.getMinutes()).slice(-2)+("0"+e.getSeconds()).slice(-2);return"agreement-".concat(t,".pdf")}},watch:{expandForm:function(e){if(e){this.layout={formCols:12,pdfCols:12,hidePdf:!0}}else{this.layout={formCols:5,pdfCols:7,hidePdf:!1}}}},mounted:function(){},created:function(){var e=this;this.fields.filter((function(e){return"signature"===e.field})).forEach((function(t){e.dialogs=Object.assign({},e.dialogs,Object(s.a)({},t.key,null)),e.pdfSignatures[t.key]={page:t.page&&t.page>0?t.page:0,xpos:t.xpos&&t.xpos>0?t.xpos:.5,ypos:t.ypos&&t.ypos>0?t.ypos:.5,scale:t.scale&&t.scale>0?t.scale:e.defaultScale}})),this.url&&this.loadPdf(this.url)},methods:{loadPdf:function(e){var t=this;try{n()(e).then((function(e){if(!e.ok)throw new Error("unexpected response ".concat(e.statusText));return e.arrayBuffer()})).then((function(e){t.pdfBuffer=e;try{var a=t.pdfBuffer;l.PDFDocument.load(a).then((function(e){t.pdfDoc=e,t.pdfDoc.saveAsBase64({dataUri:!0}).then((function(a){var s=e.getPages().length;t.browsePdf(a,s,!0)}));var a=e.getForm();t.pdfFields=a.getFields().map((function(e){return e.getName()})),console.log(t.pdfFields)}))}catch(e){console.log("Failed to read fields"),console.log(e)}}))}catch(e){console.log(e)}},getTimestamp:function(){return(new Date).toISOString()},isFieldRequired:function(e){return!(!e||"false"===e)},addSignature:function(e){var t=this,a=document.getElementById("signature-pad--".concat(e));if(a){var s=a.querySelector("canvas");this.signatures[e]={},this.signatures[e].signed=!1,this.signatures[e].canvas=s;var i=new r.a(s,{dotSize:2,minWidth:1.5,maxWidth:4});this.signatures[e].signature=i,i.addEventListener("beginStroke",(function(){console.log("Signature started")}),{once:!0}),window.addEventListener("resize",this.resizeCanvas),this.$nextTick((function(){t.resizeCanvas(null,e)}))}else console.log("No wrapper found for id: signature-pad--".concat(e))},resizeCanvas:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=a?[a]:Object.keys(this.signatures);s.forEach((function(e){var a=document.getElementById("signature-pad--".concat(e));if(a){var s=a.querySelector("canvas"),i=Math.max(window.devicePixelRatio||1,1);if(t.canvasOffsets&&t.canvasOffsets[e]&&t.canvasOffsets[e].width&&t.canvasOffsets[e].height)var n=t.canvasOffsets[e].width,l=t.canvasOffsets[e].height;else{n=s.offsetWidth,l=s.offsetHeight;t.canvasOffsets[e]={width:n,height:l}}console.log("Canvas current size ".concat(n," x ").concat(l," (device ratio: ").concat(window.devicePixelRatio,")")),s.width=n*i,s.height=l*i,s.getContext("2d").scale(i,i),t.signatures[e].signature.clear()}else console.log("No wrapper found for id: signature-pad--".concat(e))}))},openDialog:function(e){var t=this;this.dialogs=Object.assign({},this.dialogs,Object(s.a)({},e,!0)),this.$nextTick((function(){t.addSignature(e)}))},closeDialog:function(e){this.dialogs=Object.assign({},this.dialogs,Object(s.a)({},e,!1))},saveDialog:function(e){this.dialogs=Object.assign({},this.dialogs,Object(s.a)({},e,!1)),this.signatures[e].signed=!this.signatures[e].signature.isEmpty(),console.log("Signature signed [".concat(e,"]: ").concat(this.signatures[e].signed)),this.signatures[e].pngurl=this.signatures[e].signature.toDataURL()},submit:function(){var e=this;console.log(this.formData);try{var t=this.pdfBuffer;l.PDFDocument.load(t).then((function(t){var a=t.getForm();e.fields.forEach((function(t){t.key&&!["section","signature"].includes(t.field)&&e.formData[t.key]&&a.getTextField(t.key).setText(e.formData[t.key])})),a.flatten();var s=Object.keys(e.signatures).filter((function(t){return e.signatures[t].signed}));if(s.length>0){var i=s.map((function(a){var s=e.signatures[a].pngurl;return t.embedPng(s).then((function(s){var i=s,n=t.getPages(),l=e.pdfSignatures[a].page,o=n[l],r=i.scale(e.pdfSignatures[a].scale),c=o.getWidth()*e.pdfSignatures[a].xpos,d=o.getHeight()*e.pdfSignatures[a].ypos;console.log("Page ".concat(l," (").concat(o.getWidth()," x ").concat(o.getHeight(),") - insert image ").concat(a,".png (").concat(r.width," x ").concat(r.height,") at position ").concat(c," x ").concat(d)),o.drawImage(i,{x:c,y:d,width:r.width,height:r.height})}))}));Promise.all(i).then((function(){console.log("Render PDF with signatures"),t.saveAsBase64({dataUri:!0}).then((function(a){var s=t.getPages().length;e.browsePdf(a,s,!0,!0)}))}))}else console.log("PDF without signatures"),t.saveAsBase64({dataUri:!0}).then((function(a){var s=t.getPages().length;e.browsePdf(a,s,!0,!0)}))}))}catch(e){console.log(e)}},browsePdf:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=t;this.pdfFile=n,this.pdfPages=a,this.pdfTimestamp=this.getTimestamp(),this.showPdf=s,this.$nextTick((function(){e.downloadPdf=i}))}}},V=(a(493),a(41)),T=Object(V.a)(F,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-sheet",{staticClass:"d-flex flex-xs-wrap flex-sm-wrap flex-md-nowrap flex-lg-nowrap flex-xl-nowrap h-100 w-100 align-self-center",staticStyle:{"max-width":"1680px"}},[a("v-sheet",{staticClass:"flex-grow-1 flex-shrink-0 mx-2 px-2 h-100 h-xs-auto h-sm-auto overflow-y-auto col-12 col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6",staticStyle:{"min-width":"300px","max-width":"100%"}},[a("form",{ref:"form",on:{submit:function(t){return t.preventDefault(),e.submit.apply(null,arguments)}}},[a("v-list",[a("v-list-item",[a("p",{staticClass:"font-weight-bold py-0 my-0"},[e._v(e._s(e.title))])]),e._v(" "),e._l(e.fields,(function(t){return["divider"===t.field?a("v-divider",{key:t.key}):e._e(),e._v(" "),"section"===t.field?a("v-list-item",{key:t.key,attrs:{cols:"12",dense:""}},[a("p",{staticClass:"text-darken-1 py-0 mt-0 mb-2"},[e._v(e._s(t.label))])]):e._e(),e._v(" "),"textfield"===t.field?a("v-list-item",{key:t.key,attrs:{cols:"12",dense:""}},[a("v-text-field",{ref:t.key,refInFor:!0,staticClass:"mb-3",attrs:{autocomplete:"ignore-field",pattern:t.pattern?t.pattern:null,title:t.hint?t.hint:null,minlength:t.minlength?t.minlength:null,maxlength:t.maxlength?t.maxlength:null,required:e.isFieldRequired(t.required),autocapitalize:t.autocapitalize?t.autocapitalize:null,suffix:t.suffix?t.suffix:null,type:t.specialType?t.specialType:null,hint:t.hint?t.hint:null,"persistent-hint":!(!t.hint||!e.formData[t.key]),placeholder:"","persistent-placeholder":"",outlined:"",dense:"","hide-details":!e.formData[t.key]&&"auto"},on:{focus:function(e){return e.target.select()}},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                "+e._s(t.label)),e.isFieldRequired(t.required)?a("span",{staticClass:"red--text text--darken-2"},[e._v(" * ")]):e._e()]},proxy:!0}],null,!0),model:{value:e.formData[t.key],callback:function(a){e.$set(e.formData,t.key,a)},expression:"formData[item.key]"}})],1):e._e(),e._v(" "),"countries"===t.field?a("v-list-item",{key:t.key,attrs:{cols:"12",dense:""}},[a("v-autocomplete",{ref:t.key,refInFor:!0,staticClass:"mb-3",attrs:{autocomplete:"ignore-field",items:e.getCountries,"item-text":function(e){return e.name+" "+e.flag},"item-value":function(e){return e.name},required:e.isFieldRequired(t.required),placeholder:"","persistent-placeholder":"",outlined:"",dense:"","hide-details":""},on:{focus:function(e){return e.target.select()}},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                "+e._s(t.label)),e.isFieldRequired(t.required)?a("span",{staticClass:"red--text text--darken-2"},[e._v(" * ")]):e._e()]},proxy:!0}],null,!0),model:{value:e.formData[t.key],callback:function(a){e.$set(e.formData,t.key,a)},expression:"formData[item.key]"}})],1):e._e(),e._v(" "),"textarea"===t.field?a("v-list-item",{key:t.key,attrs:{cols:"12",dense:""}},[a("v-textarea",{ref:t.key,refInFor:!0,staticClass:"mb-3",attrs:{autocomplete:"ignore-field",pattern:t.pattern?t.pattern:null,title:t.hint?t.hint:null,minlength:t.minlength?t.minlength:null,maxlength:t.maxlength?t.maxlength:null,required:e.isFieldRequired(t.required),hint:t.hint?t.hint:null,"persistent-hint":!(!t.hint||!e.formData[t.key]),placeholder:"","persistent-placeholder":"",outlined:"",dense:"",rows:1,"hide-details":!e.formData[t.key]&&"auto"},on:{focus:function(e){return e.target.select()}},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n                "+e._s(t.label)),e.isFieldRequired(t.required)?a("span",{staticClass:"red--text text--darken-2"},[e._v(" * ")]):e._e()]},proxy:!0}],null,!0),model:{value:e.formData[t.key],callback:function(a){e.$set(e.formData,t.key,a)},expression:"formData[item.key]"}})],1):e._e(),e._v(" "),"signature"===t.field?a("v-list-item",{key:t.key,attrs:{cols:"12",dense:""}},[a("v-card",{staticClass:"px-0 mb-3",staticStyle:{width:"100%"},attrs:{elevation:"0",outlined:""}},[a("v-card-text",[a("v-row",{staticClass:"mr-xs-12 pr-sm-8",attrs:{justify:"space-between","no-gutters":""}},[a("v-col",{attrs:{cols:"8"}},[a("div",{staticClass:"font-weight-bold"},[e._v(e._s(t.label))])]),e._v(" "),a("v-col",{attrs:{cols:"4"}},[a("v-btn",{attrs:{color:"primary",block:""},on:{click:function(a){return e.openDialog(t.key)}}},[e._v("\n                      Add signature\n                    ")])],1)],1),e._v(" "),a("v-row",{staticClass:"mr-xs-12 pr-sm-8",attrs:{align:"center",justify:"space-between","no-gutters":""}},[a("v-col",{staticStyle:{height:"40px"},attrs:{cols:"12"}},[e.signatures&&e.signatures[t.key]&&e.signatures[t.key].signed?a("div",[a("img",{staticStyle:{"max-height":"40px"},attrs:{src:e.signatures[t.key].pngurl}})]):a("div",[e._v("\n                      Add digital signature now or sign later\n                    ")])])],1),e._v(" "),a("v-dialog",{attrs:{fullscreen:"","hide-overlay":"",transition:"dialog-bottom-transition"},model:{value:e.dialogs[t.key],callback:function(a){e.$set(e.dialogs,t.key,a)},expression:"dialogs[item.key]"}},[a("v-card",{staticClass:"prevent-select",staticStyle:{height:"100%"}},[a("v-toolbar",[a("v-toolbar-title",[e._v(e._s(t.label))]),e._v(" "),a("v-spacer"),e._v(" "),a("v-btn",{attrs:{text:""},on:{click:function(a){return e.closeDialog(t.key)}}},[e._v("\n                        Close\n                      ")]),e._v(" "),a("v-toolbar-items",[a("v-btn",{attrs:{text:""},on:{click:function(a){return e.saveDialog(t.key)}}},[e._v("\n                          Save\n                        ")])],1)],1),e._v(" "),a("div",{staticClass:"signature-card"},[a("div",{staticClass:"signature-pad mt-8",attrs:{id:"signature-pad--"+t.key}},[a("div",{staticClass:"signature-pad--body"},[a("canvas")]),e._v(" "),a("div",{staticClass:"signature-pad--footer"},[a("div",{staticClass:"description"},[e._v("Sign above")])])])])],1)],1)],1)],1)],1):e._e()]})),e._v(" "),a("v-list-item",[a("v-row",{staticClass:"px-2",attrs:{align:"center",justify:"space-around"}},[a("v-col",{attrs:{cols:"12"}},[a("v-btn",{staticClass:"mr-8 px-0",attrs:{type:"submit",block:"",color:"teal",disabled:!e.formFilled}},[e._v("Generate Agreement")])],1)],1)],1),e._v(" "),a("v-list-item",[a("v-row",{staticClass:"px-2",attrs:{align:"center",justify:"space-around"}},[a("v-col",{attrs:{cols:"12"}},[a("v-btn",{staticClass:"mr-8 px-0",attrs:{block:"",color:"success",href:e.pdfFile,download:e.getPdfTitle,target:"_blank",disabled:!e.pdfFile||!e.downloadPdf}},[e._v("Download Agreement")])],1)],1)],1)],2)],1)]),e._v(" "),a("v-sheet",{staticClass:"flex-grow-1 flex-shrink-1 mx-2 px-2 h-100 col-12 col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6",staticStyle:{"min-width":"300px","max-width":"100%"}},[!e.showPdf?e._e():a("EmbedPdfViewer",{attrs:{source:e.pdfData,pages:e.pdfPages,height:"500"}})],1)],1)}),[],!1,null,null,null);t.default=T.exports}}]);